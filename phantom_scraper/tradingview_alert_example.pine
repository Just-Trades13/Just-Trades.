//@version=5
strategy("TradingView to Tradovate Webhook Example", overlay=true, initial_capital=10000, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// Input parameters
rsi_length = input.int(14, title="RSI Length")
rsi_overbought = input.int(70, title="RSI Overbought")
rsi_oversold = input.int(30, title="RSI Oversold")
ma_length = input.int(20, title="Moving Average Length")

// Calculate indicators
rsi = ta.rsi(close, rsi_length)
ma = ta.sma(close, ma_length)

// Define conditions
long_condition = rsi < rsi_oversold and close > ma
short_condition = rsi > rsi_overbought and close < ma
close_long_condition = rsi > rsi_overbought
close_short_condition = rsi < rsi_oversold

// Strategy entries and exits
if long_condition
    strategy.entry("Long", strategy.long)
    
if short_condition
    strategy.entry("Short", strategy.short)
    
if close_long_condition
    strategy.close("Long")
    
if close_short_condition
    strategy.close("Short")

// Plot indicators
plot(ma, "MA", color=color.blue)
hline(rsi_overbought, "RSI Overbought", color=color.red)
hline(rsi_oversold, "RSI Oversold", color=color.green)

// Alert conditions for webhook
alertcondition(long_condition, title="Long Signal", message='{"symbol": "{{ticker}}", "action": "buy", "quantity": 1, "price": "{{close}}", "strategy": "RSI_MA_Strategy"}')
alertcondition(short_condition, title="Short Signal", message='{"symbol": "{{ticker}}", "action": "sell", "quantity": 1, "price": "{{close}}", "strategy": "RSI_MA_Strategy"}')
alertcondition(close_long_condition, title="Close Long", message='{"symbol": "{{ticker}}", "action": "close", "strategy": "RSI_MA_Strategy"}')
alertcondition(close_short_condition, title="Close Short", message='{"symbol": "{{ticker}}", "action": "close", "strategy": "RSI_MA_Strategy"}')

// Alternative: Single alert with all conditions
alertcondition(long_condition or short_condition or close_long_condition or close_short_condition, 
               title="Trading Signal", 
               message='{"symbol": "{{ticker}}", "action": "{{strategy.order.action}}", "quantity": 1, "price": "{{close}}", "strategy": "RSI_MA_Strategy"}')
